

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/Blog/img/favicon.ico">
  <link rel="icon" href="/Blog/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Daolin">
  <meta name="keywords" content="">
  
    <meta name="description" content="cv2 画图形12345678910111213141516171819202122def draw():    img &#x3D; np.zeros((256, 512, 3), np.uint8) # 宽256, 高512    img[:] &#x3D; 255, 0, 0    # 在(0,0) (512, 256)之间画一条颜色为BGR(0, 255, 255)的线, 线宽5px    cv2.line">
<meta property="og:type" content="article">
<meta property="og:title" content="opencv">
<meta property="og:url" content="https://daolinzhou.github.io/Blog/2020/09/20/opencv-trap/">
<meta property="og:site_name" content="Daolin&#39;s Repository">
<meta property="og:description" content="cv2 画图形12345678910111213141516171819202122def draw():    img &#x3D; np.zeros((256, 512, 3), np.uint8) # 宽256, 高512    img[:] &#x3D; 255, 0, 0    # 在(0,0) (512, 256)之间画一条颜色为BGR(0, 255, 255)的线, 线宽5px    cv2.line">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/test_cv2.jpg">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/affine_1.PNG">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/affine.PNG">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/affine_2.PNG">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/contours.PNG">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/contours_1.PNG">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/contours_2.PNG">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/contours_3.PNG">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/j.png">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/contours_j.png">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/approx.PNG">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/rect.PNG">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/hello.png">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/hello_rect.png">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/lapkern_1.png">
<meta property="og:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/lapkern_2.png">
<meta property="article:published_time" content="2020-09-21T00:38:57.000Z">
<meta property="article:modified_time" content="2022-01-02T08:53:17.050Z">
<meta property="article:author" content="Daolin">
<meta property="article:tag" content="python3">
<meta property="article:tag" content="opencv">
<meta property="article:tag" content="图像学">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://daolinzhou.github.io/Blog/intro/com_graphic/test_cv2.jpg">
  
  
  <title>opencv - Daolin&#39;s Repository</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/Blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"daolinzhou.github.io","root":"/Blog/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/Blog/local-search.xml"};
  </script>
  <script  src="/Blog/js/utils.js" ></script>
  <script  src="/Blog/js/color-schema.js" ></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/Blog/">
      <strong>Daolin&#39;s Repo</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/Blog/intro/eye.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="opencv">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-09-20 17:38" pubdate>
        2020年9月20日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.3k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      45 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">opencv</h1>
            
            <div class="markdown-body">
              <link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><span id="more"></span>
<h2 id="cv2-画图形"><a href="#cv2-画图形" class="headerlink" title="cv2 画图形"></a>cv2 画图形</h2><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw</span>():<br>    img = np.zeros((<span class="hljs-number">256</span>, <span class="hljs-number">512</span>, <span class="hljs-number">3</span>), np.uint8) <span class="hljs-comment"># 宽256, 高512</span><br>    img[:] = <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># 在(0,0) (512, 256)之间画一条颜色为BGR(0, 255, 255)的线, 线宽5px</span><br>    cv2.line(img, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">512</span>, <span class="hljs-number">256</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>), <span class="hljs-number">5</span>)<br><br>    <span class="hljs-comment"># 画长方形</span><br>    <span class="hljs-comment"># cv2.rectangle(head, (0, 0), (100, 200), (0, 0, 255), cv2.FILLED)</span><br>    cv2.rectangle(img, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">100</span>, <span class="hljs-number">200</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>)<br><br>    <span class="hljs-comment"># 画圆</span><br>    cv2.circle(img, (<span class="hljs-number">400</span>, <span class="hljs-number">50</span>), <span class="hljs-number">30</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">5</span>)<br><br>    <span class="hljs-comment"># 写字</span><br>    cv2.putText(img, <span class="hljs-string">&quot;OPENCV&quot;</span>, (<span class="hljs-number">200</span>, <span class="hljs-number">200</span>), cv2.FONT_HERSHEY_COMPLEX,<br>                <span class="hljs-number">1</span>,  <span class="hljs-comment"># 比例尺</span><br>                (<span class="hljs-number">0</span>, <span class="hljs-number">150</span>, <span class="hljs-number">0</span>),<br>                <span class="hljs-number">1</span>)  <span class="hljs-comment"># 厚度</span><br><br>    <span class="hljs-comment"># cv2.imshow(&quot;Image&quot;, img)</span><br>    cv2.imwrite(<span class="hljs-string">&quot;test_cv2.jpg&quot;</span>, img)<br></code></pre></td></tr></table></figure>
<p><img src="/Blog/intro/com_graphic/test_cv2.jpg" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p><br></p>
<h2 id="仿射变换"><a href="#仿射变换" class="headerlink" title="仿射变换"></a>仿射变换</h2><p>cv2 使用 warpAffine 来进行仿射变换</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">cv2.warpAffine(src, M, dsize, flags, mode, value)</span><br><span class="hljs-attribute">src</span><span class="hljs-punctuation">  :</span> <span class="hljs-string">原图像</span><br><span class="hljs-attribute">M</span><span class="hljs-punctuation">    :</span> <span class="hljs-string">变换矩阵</span><br><span class="hljs-attribute">dsize</span><span class="hljs-punctuation">:</span> <span class="hljs-string">目标大小</span><br><span class="hljs-attribute">flags</span><span class="hljs-punctuation">:</span> <span class="hljs-string">插值算法</span><br><span class="hljs-attribute">mode</span><span class="hljs-punctuation"> :</span> <span class="hljs-string">边界外推法</span><br><span class="hljs-attribute">value</span><span class="hljs-punctuation">:</span> <span class="hljs-string">填充边界的值</span><br></code></pre></td></tr></table></figure>
<p>变换矩阵是2x3的矩阵, 可以自己指定, 然而cv2也提供了一些便捷的结构生成它们</p>
<p><img src="/Blog/intro/com_graphic/affine_1.PNG" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p><br></p>
<p>方法一: 使用<code>getRotationMatrix2D</code></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">get<span class="hljs-constructor">RotationMatrix2D(<span class="hljs-params">center</span>, <span class="hljs-params">angle</span>, <span class="hljs-params">scale</span>)</span><br></code></pre></td></tr></table></figure>
<p>方法二: 使用<code>getAffineTransform(src[], dst[])</code></p>
<p>告诉cv2点的变换结果(变换前和变换后的三个点), 让它自己计算转移矩阵</p>
<p><img src="/Blog/intro/com_graphic/affine.PNG" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<blockquote>
<p>仿射变换后原本平行的线依然平行</p>
</blockquote>
<h2 id="透视变换"><a href="#透视变换" class="headerlink" title="透视变换"></a>透视变换</h2><p><code>getPersectiveTransform</code> 和 <code>warpPerspective</code> </p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">get<span class="hljs-constructor">PersectiveTransform(<span class="hljs-params">src</span>, <span class="hljs-params">dst</span>)</span><br>需要四个点(图的四个角)<br>得到<span class="hljs-number">3</span>x3的矩阵<br></code></pre></td></tr></table></figure>
<blockquote>
<p>透视变换和仿射变换不同, 原本平行的线可能会交叉, 原本交叉的线也可能会平行</p>
</blockquote>
<p><img src="/Blog/intro/com_graphic/affine_2.PNG" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p><br></p>
<p><br></p>
<h2 id="轮廓"><a href="#轮廓" class="headerlink" title="轮廓"></a>轮廓</h2><p>一般为了准确性, 会先对图像进行二值化或Canny边缘检测</p>
<h3 id="查找轮廓"><a href="#查找轮廓" class="headerlink" title="查找轮廓"></a>查找轮廓</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">contours, hierarchy = find<span class="hljs-constructor">Contours(<span class="hljs-params">img</span>, <span class="hljs-params">mode</span>, ApproximationMode<span class="hljs-operator">...</span>)</span><br></code></pre></td></tr></table></figure>
<p>可以把轮廓都保存在一个list中, 或者按照树形结构存储..这个由<code>mode</code> 参数控制</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">RETR_EXTERNAL</span>=<span class="hljs-number">0</span>, 只检测外轮廓<br><span class="hljs-attr">RETR_LIST</span>=<span class="hljs-number">1</span>, 检测的轮廓不建立等级关系<br><span class="hljs-attr">RETR_CCOMP</span>=<span class="hljs-number">2</span>, 每层最多两级<br><span class="hljs-attr">RETR_TREE</span>=<span class="hljs-number">3</span>, 按树形存储轮廓<br></code></pre></td></tr></table></figure>
<p>一般使用 list 或 tree</p>
<p>几个例子, 红色的是边框</p>
<p><img src="/Blog/intro/com_graphic/contours.PNG" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p>list的结果, 顺序是由里到外, 由小到大</p>
<p><img src="/Blog/intro/com_graphic/contours_1.PNG" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p>CCOMP的结果 </p>
<p><img src="/Blog/intro/com_graphic/contours_2.PNG" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p>tree的结果, 由外到里</p>
<p><img src="/Blog/intro/com_graphic/contours_3.PNG" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p><br></p>
<h3 id="ApproximationMode"><a href="#ApproximationMode" class="headerlink" title="ApproximationMode"></a>ApproximationMode</h3><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-built_in">CHAIN_APPROX_NONE,</span> 保存所有轮廓上的点<br><span class="hljs-built_in">CHAIN_APPROX_SIMPLE,</span> 只保存角点<br></code></pre></td></tr></table></figure>
<p><br></p>
<h3 id="轮廓绘制"><a href="#轮廓绘制" class="headerlink" title="轮廓绘制"></a>轮廓绘制</h3><p>使用画线的方法手动连接也是可以的</p>
<p>opencv写好了一个函数 </p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">draw<span class="hljs-constructor">Contour(<span class="hljs-params">img</span>, <span class="hljs-params">countours</span>, <span class="hljs-params">contourIdx</span>, <span class="hljs-params">color</span>, <span class="hljs-params">thickness</span><span class="hljs-operator">...</span>)</span><br></code></pre></td></tr></table></figure>
<p>contourIdx 控制显示第几个轮廓(0代表第一个轮廓 ), <code>-1</code> 表示绘制所有轮廓</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    img = cv2.imread(<span class="hljs-string">&quot;j.png&quot;</span>)<br>    img_grey = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)<br>    <br>    <span class="hljs-comment"># 二值化</span><br>    res, img_grey = cv2.threshold(img_grey, <span class="hljs-number">150</span>, <span class="hljs-number">255</span>, cv2.THRESH_BINARY)<br>    <span class="hljs-comment"># 寻找轮廓</span><br>    contour, hierarchy = cv2.findContours(img_grey, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)<br>    <span class="hljs-comment"># 绘制轮廓</span><br>    cv2.drawContours(img, contour, -<span class="hljs-number">1</span>, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>)<br>    <br>    cv2.imshow(<span class="hljs-string">&quot;img&quot;</span>, img)<br>    cv2.waitKey(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>
<p><img src="/Blog/intro/com_graphic/j.png" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p><img src="/Blog/intro/com_graphic/contours_j.png" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<h3 id="轮廓的面积和周长"><a href="#轮廓的面积和周长" class="headerlink" title="轮廓的面积和周长"></a>轮廓的面积和周长</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">contour<span class="hljs-constructor">Area(<span class="hljs-params">counter</span>)</span> # 得到轮廓面积<br>arc<span class="hljs-constructor">Length(<span class="hljs-params">curve</span>, <span class="hljs-params">closed</span>)</span> # 得到轮廓周长, 轮廓可能不闭合<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">area = cv2.contourArea(contour[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;area =&quot;</span>, area)<br><br>length = cv2.arcLength(contour[<span class="hljs-number">1</span>], <span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;length =&quot;</span>, length)<br></code></pre></td></tr></table></figure>
<p><br></p>
<h3 id="多边形逼近与凸包"><a href="#多边形逼近与凸包" class="headerlink" title="多边形逼近与凸包"></a>多边形逼近与凸包</h3><p><img src="/Blog/intro/com_graphic/approx.PNG" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">approxPoints = approxPolyDP(curvem, epsilon, closed) <span class="hljs-comment"># 多边形逼近</span><br>hull = convexHull(points, clockwise, ...) <span class="hljs-comment"># 凸包</span><br></code></pre></td></tr></table></figure>
<p>例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">drawShape</span>(<span class="hljs-params">src, points</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(points)):<br>        <span class="hljs-keyword">if</span> i+<span class="hljs-number">1</span> == <span class="hljs-built_in">len</span>(points):<br>            x, y = points[i][<span class="hljs-number">0</span>]<br>            x1, y1 = points[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>            cv2.line(src, (x, y), (x1, y1), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">else</span>:<br>            x, y = points[i][<span class="hljs-number">0</span>]<br>            x1, y1 = points[i + <span class="hljs-number">1</span>][<span class="hljs-number">0</span>]<br>            cv2.line(src, (x, y), (x1, y1), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">1</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># ... get contour</span><br>	<span class="hljs-comment"># 多边形逼近</span><br>    e = <span class="hljs-number">5</span><br>    approx = cv2.approxPolyDP(contour[<span class="hljs-number">0</span>], e, <span class="hljs-literal">True</span>)<br>    drawShape(img, approx)<br><br>    <span class="hljs-comment"># 凸包</span><br>    hull = cv2.convexHull(contour[<span class="hljs-number">0</span>])<br>    drawShape(img, hull)<br></code></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="外接矩形"><a href="#外接矩形" class="headerlink" title="外接矩形"></a>外接矩形</h2><p>外接矩形一般分为两种</p>
<ul>
<li>普通的外接矩形</li>
<li>最小外接矩形</li>
</ul>
<p><img src="/Blog/intro/com_graphic/rect.PNG" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p>绿色的就是普通的外接矩形, 红色的是最小外接矩形</p>
<p>最小外接矩形函数</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">minAreaRect</span><span class="hljs-params">(points)</span></span><br>points : 轮廓<br>返回: RotatedRect<br></code></pre></td></tr></table></figure>
<p>普通的外接矩形函数</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">boundingRect</span><span class="hljs-params">(points)</span></span><br>points : 轮廓<br>返回: Rect<br></code></pre></td></tr></table></figure>
<p><br></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    img = cv2.imread(<span class="hljs-string">&quot;hello.png&quot;</span>)<br>    img_grey = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)<br><br>    <span class="hljs-comment"># 二值化</span><br>    res, img_grey = cv2.threshold(img_grey, <span class="hljs-number">150</span>, <span class="hljs-number">255</span>, cv2.THRESH_BINARY)<br>    <span class="hljs-comment"># 寻找轮廓</span><br>    contour, hierarchy = cv2.findContours(img_grey, cv2.RETR_TREE, cv2.CHAIN_APPROX_SIMPLE)<br><br>    <span class="hljs-comment"># 最小外接矩阵</span><br>    rotated_rect = cv2.minAreaRect(contour[<span class="hljs-number">1</span>])<br>    <span class="hljs-comment"># 由于 rotated_rect 得到的点是浮点型,</span><br>    box = cv2.boxPoints(rotated_rect)   <span class="hljs-comment"># 得到矩形</span><br>    box = np.uint0(box)     <span class="hljs-comment"># 转成 int0 类型</span><br>    cv2.drawContours(img, [box], <span class="hljs-number">0</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">2</span>)<br><br>    <span class="hljs-comment"># 普通外接矩阵</span><br>    x, y, w, h = cv2.boundingRect(contour[<span class="hljs-number">1</span>])<br>    cv2.rectangle(img, (x, y), (x+w, y+h), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>)<br><br>    cv2.imshow(<span class="hljs-string">&quot;hello.png&quot;</span>, img)<br>    cv2.waitKey(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>
<p><img src="/Blog/intro/com_graphic/hello.png" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p><img src="/Blog/intro/com_graphic/hello_rect.png" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p>蓝色就是最小外接矩形, 红色是普通的外接矩形</p>
<p><br></p>
<p><br></p>
<h2 id="去背景"><a href="#去背景" class="headerlink" title="去背景"></a>去背景</h2><p><code>createBackgroundSubtractorMOG2()</code> 或 <code>createBackgroundSubtractorKNN()</code></p>
<p>一般来说, 在视频中我们会认为在一个时间段中, 运动的是前景, 静止的是背景</p>
<p>通常使用默认参数, 参数<code>history</code> 代表存储的帧数, 即上面所说的”时间段”</p>
<p><br></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    fourcc = cv2.VideoWriter_fourcc(*<span class="hljs-string">&#x27;mp4v&#x27;</span>)<br>    vw = cv2.VideoWriter(<span class="hljs-string">&#x27;out.mp4&#x27;</span>, fourcc, <span class="hljs-number">25</span>, (<span class="hljs-number">1280</span>, <span class="hljs-number">720</span>))<br><br>    video = cv2.VideoCapture(<span class="hljs-string">&quot;./video.mp4&quot;</span>)<br>    bgsubmog = cv2.createBackgroundSubtractorKNN()<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        ret, frame = video.read()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ret:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> ret:<br>            res = bgsubmog.apply(frame)<br>            <span class="hljs-comment"># 去掉目标外部的噪音</span><br>            res = cv2.morphologyEx(res, cv2.MORPH_OPEN, np.ones((<span class="hljs-number">5</span>, <span class="hljs-number">5</span>)))<br>            <span class="hljs-comment"># 去掉目标内部的噪音</span><br>            res = cv2.morphologyEx(res, cv2.MORPH_CLOSE, np.ones((<span class="hljs-number">5</span>, <span class="hljs-number">5</span>)))<br>            <span class="hljs-comment"># 获取边缘</span><br>            contours, hierarchy = cv2.findContours(res, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)<br><br>            <span class="hljs-keyword">for</span> contour <span class="hljs-keyword">in</span> contours:<br>                x, y, w, h = cv2.boundingRect(contour)<br>                cv2.rectangle(frame, (x, y), (x+w, y+h), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>)<br>            cv2.imshow(<span class="hljs-string">&#x27;video&#x27;</span>, frame)<br>            vw.write(frame)     <span class="hljs-comment"># 输出</span><br><br>        key = cv2.waitKey(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">if</span> key == (<span class="hljs-number">0xff</span> &amp; <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;q&#x27;</span>)):<br>            <span class="hljs-keyword">break</span><br>    vw.release()<br>    video.release()<br>    cv2.destroyAllWindows()<br></code></pre></td></tr></table></figure>
<video id="video" controls="" preload="none" width="100%">
<source id="mp4" src="/Blog/intro/com_graphic/video.mp4" type="video/mp4">
</video>

<video id="video" controls="" preload="none" width="100%">
<source id="mp4" src="/Blog/intro/com_graphic/out.mp4" type="video/mp4">
</video>










<h2 id="imshow和imwrite结果不同"><a href="#imshow和imwrite结果不同" class="headerlink" title="imshow和imwrite结果不同"></a>imshow和imwrite结果不同</h2><p>imwrite always expects [0,255], whereas imshow expects [0,1] for floating point and [0,255] for unsigned chars.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():<br>    img = cv2.imread(<span class="hljs-string">&quot;../resources/cards.jpg&quot;</span>)<br>    img = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)<br>    <br>    lapkern = np.array([[<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>],<br>                        [-<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, -<span class="hljs-number">1</span>],<br>                        [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]])<br>    lap = conv2(img, lapkern, mode=<span class="hljs-string">&quot;same&quot;</span>)	<span class="hljs-comment"># 在图像学的那篇文章中我实现了conv2</span><br>    cv2.imshow(<span class="hljs-string">&quot;test1&quot;</span>, lap.astype(<span class="hljs-built_in">float</span>))<br>    cv2.imwrite(<span class="hljs-string">&quot;test2.png&quot;</span>, lap)<br></code></pre></td></tr></table></figure>
<p>期望显示的图片</p>
<p><img src="/Blog/intro/com_graphic/lapkern_1.png" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p>实际显示的图片:</p>
<p><img src="/Blog/intro/com_graphic/lapkern_2.png" srcset="/Blog/img/loading.gif" lazyload alt=""></p>
<p><br></p>
<p>然而实际保存的图片却是期望的图片.</p>
<p><br></p>
<p>这是因为imshow和imwrite的期望值不同.</p>
<p>要解决这个问题, 有两种方法</p>
<ol>
<li>由于imshow和imwrite都支持[0, 255]的整型, 所以我们就把它们转化为整型进行存储和展示</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 一定要进行一次过滤, 不然.astype(np.unit8)会有整型溢出, -1 会变为 255, 256会变为-1</span><br>lap[lap &lt; <span class="hljs-number">0</span>] = <span class="hljs-number">0</span><br>lap[lap &gt; <span class="hljs-number">255</span>] = <span class="hljs-number">255</span><br><br>cv2.imshow(<span class="hljs-string">&quot;test1&quot;</span>, lap.astype(np.uint8))<br>cv2.imwrite(<span class="hljs-string">&quot;test1.png&quot;</span>, lap.astype(np.uint8))<br></code></pre></td></tr></table></figure>
<p><br></p>
<ol>
<li>第二种方法就是imshow的参数用[0, 1]之间的小数, imwrite的参数用[0, 255]</li>
</ol>
<p>此时就不需要过滤了, imshow和imwrite会自动过滤</p>
<p>(第一种方法不能自动过滤是因为我们在过滤前就溢出了)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">cv2.imshow(<span class="hljs-string">&quot;test2&quot;</span>, lap/<span class="hljs-number">255</span>)<br>cv2.imwrite(<span class="hljs-string">&quot;test2.png&quot;</span>, lap)<br></code></pre></td></tr></table></figure>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/Blog/tags/python3/">python3</a>
                    
                      <a class="hover-with-bg" href="/Blog/tags/opencv/">opencv</a>
                    
                      <a class="hover-with-bg" href="/Blog/tags/%E5%9B%BE%E5%83%8F%E5%AD%A6/">图像学</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/Blog/2020/12/20/fast-and-sift/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">FAST and SIFT</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/Blog/2020/09/12/computer-graphic/">
                        <span class="hidden-mobile">图像学</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/Blog/js/events.js" ></script>
<script  src="/Blog/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/Blog/js/local-search.js" ></script>



  
    <script  src="/Blog/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  











<!-- 主题的启动项 保持在最底部 -->
<script  src="/Blog/js/boot.js" ></script>


</body>
</html>
